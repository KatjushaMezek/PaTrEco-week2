---
title: "PaTrEco - EXERCISE 2"
author: "Katjusa Mezek"
date: "5/2/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Patterns and trends in environmental data - Exercise 2

## Packages & data import

```{r}
# Load packages

library(readr)        # to import tabular data (e.g. csv)
library(dplyr)        # to manipulate (tabular) data
library(ggplot2)      # to visualize data
library(sf)           # to handle spatial vector data
library(terra)        # To handle raster data
library(lubridate)
library(zoo)
library(scales)

# Import the Wildschwein data

wildschwein_BE <- read_delim("wildschwein_BE_2056.csv",",") # adjust path

wildschwein_BE <- st_as_sf(wildschwein_BE, coords = c("E", "N"), crs = 2056, remove = FALSE)

```

# Task 1 - Getting an overview

```{r}
# Calculate the time difference between subsequent rows

wildschwein_BE <- group_by(wildschwein_BE,TierID) # group by TierID

wildschwein_BE$timelag  <- as.numeric(difftime(lead(wildschwein_BE$DatetimeUTC), wildschwein_BE$DatetimeUTC),units = "secs")

# turn timelag to integer

as.integer(wildschwein_BE$timelag)

# A summary for individuals
wildschwein_BE %>% 
  group_by(TierID) %>%
  summarise(
    mean_timelag=mean(timelag, na.rm=T)
  )

```

## Questions
How many individuals were tracked?
```{r}
unique(wildschwein_BE$TierName)
unique(wildschwein_BE$TierID)

#three individuals were tracked
```

For how long were the individual tracked? Are there gaps?
```{r}
ggplot(wildschwein_BE, aes(x=wildschwein_BE$DatetimeUTC, y=wildschwein_BE$TierID)) +
  geom_line()

range_002A=range(wildschwein_BE$DatetimeUTC[wildschwein_BE$TierID=="002A"])
range_016A=range(wildschwein_BE$DatetimeUTC[wildschwein_BE$TierID=="016A"])
range_018A=range(wildschwein_BE$DatetimeUTC[wildschwein_BE$TierID=="018A"])

# The animal 002A was tracked longer (Oct2014 - Jul2015) than 016A and 018A.
# The start of the tracking is different for each animal (same day - 2014-11-07, but different time).
#The tracking ended on different dates, as seen in the plot. The tracking of 018A and 022A ended on the same day but not same time

```

Were all individuals tracked concurrently or sequentially?
```{r}
# The individuals were tracked concurrently because there is a large time area when they were all tracked at the same time between January 2015 and June 2015), but with slight delays.

```

What is the temporal sampling interval between the locations?
```{r}
# The sampling interval can be interpreted as the time lag
# it is approximately 900s (15 minutes)
```

# Task 2 - Deriving movement parameters I: Speed
```{r}
# Calculate Euclidean distance
euc.dist = function(x,y) (sqrt((lead(x)-x)^2+(lead(y)-y)^2))

wildschwein_BE$steplength= euc.dist(wildschwein_BE$E, wildschwein_BE$N)

# Calculate speed between locations
wildschwein_BE$Speed = wildschwein_BE$steplength/wildschwein_BE$timelag

#The unit is in degrees/s (timelag is in seconds and steplength is in degrees, since it was calculated from the euclidean distance)
#In order to get measurable distance we would need to take into account the earths curve and terrain - haversine

```
